<section data-ng-cloak class="text-left wrapper" xmlns="http://www.w3.org/1999/html">
    <!--div data-ng-show="loadingModel" class="overlay"></div-->

    <!-- the visualizer part on the left -->
    <div class="visualization">
        <div class="wrapper">
            <div class="dropdown-select visualization-options"
                 title="select feature to color visualization"
                 data-dropdown-select="::features"
                 data-dropdown-model="viewerOptions.coloringFeature"
                 data-dropdown-item-label="name">
            </div>

            <!-- PV instance -->
            <div id="protein-visualizer" class="visualization-options"></div>

            <!-- general render options -->
            <div class="visualization-options">
                <!-- ligands -->
                <div class="option pull-right"
                     data-ng-click="viewerOptions.renderLigands = !viewerOptions.renderLigands"
                     data-ng-class="{ active: viewerOptions.renderLigands }">render ligands</div>
            </div>

            <!-- PLIP options -->
            <div class="dropdown-select visualization-options"
                 title="select interaction type to visualize"
                 data-dropdown-select="::interactionTypes"
                 data-dropdown-model="viewerOptions.interactionType"
                 data-dropdown-item-label="name">
            </div>
            <div class="visualization-options" data-ng-show="loadingModel">loading model data...</div>
            <div class="visualization-options" data-ng-show="loadingAlignment">loading alignment...</div>
            <div class="visualization-options" data-ng-show="loadingStructure">loading structure...</div>
        </div>
    </div>

    <!-- the edit/data part on the right -->
    <div class="chain-view">
        <div class="wrapper">
            <!-- general project navigation -->
            <div class="chain-view-header clearfix">
                <div data-ng-class="{ active: isSelected(0) }" data-ng-click="selectTab(0)"><span class="fa fa-info"></span> general</div>
                <div data-ng-class="{ active: isSelected(1) }" data-ng-click="selectTab(1)"><span class="fa fa-bars"></span> homologous</div>
            </div>

            <div class="tse-scrollable">
                <div class="tse-content">
                    <!-- general information -->
                    <div data-ng-show="isSelected(0)" class="view-tab">
                        <h4>general information</h4>
                        <div>{{::reference.title}}</div>
                        <div>
                            <ng-pluralize count="::reference.ligands.length"
                                          when="{'0': 'no ligands',
                                         'one': '1 ligand',
                                         'other': '{} ligands'}">
                            </ng-pluralize>
                            <ng-pluralize count="::(reference.ligands | filter: { type : 'water' }).length"
                                          when="{'0': '(none being water)',
                                     'one': '(1 being water)',
                                     'other': '({} being water)'}">
                            </ng-pluralize>
                        </div>

                        <h4>homologous protein chains</h4>
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>PDB</th>
                                    <th>UniProt</th>
                                    <th>Pfam</th>
                                    <th>IUBMB</th>
                                    <th>title</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr data-ng-repeat="chain in ::alignment.chains">
                                    <td>
                                        <a data-ng-href="chain/{{::chain.id}}">
                                            {{::chain.id}}
                                        </a>
                                    </td>
                                    <td>
                                        <a target="_blank" data-ng-href="http://www.rcsb.org/pdb/explore.do?structureId={{::reference.pdbId}}">{{::reference.pdbId}}</a>
                                    </td>
                                    <td>
                                        <a target="_blank" data-ng-href="http://www.uniprot.org/uniprot/{{::reference.uniprot}}">{{::reference.uniprot}}</a>
                                    </td>
                                    <td>
                                        <a target="_blank" data-ng-href="http://pfam.xfam.org/family/{{::reference.pfam}}">{{::reference.pfam}}</a>
                                    </td>
                                    <td>
                                        <a target="_blank" data-ng-href="http://www.chem.qmul.ac.uk/iubmb/enzyme/EC{{::reference.ec | ec}}.html">{{::reference.ec}}</a>
                                    </td>
                                    <td>
                                        ?
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- homologous sequences -->
                    <div data-ng-show="isSelected(1)" class="view-tab homologous">
                        <input type="number"
                               title="window size"
                               data-ng-model="windowSize"
                               style="color: black"
                               min="0"
                               max="10"
                               data-ng-hide="selectionMode" />

                        <div data-ng-click="leaveSelectionMode()"
                             data-ng-show="selectionMode">-> leave selection mode</div>

                        <div data-ng-show="selectionMode">-> align fragments locally</div>

                        <br />

                        <div class="alignment">
                            <!-- navigation/editing/control over sequence objects -->
                            <div class="ids">
                                <div data-ng-repeat="chain in ::alignment.chains track by chain.id"
                                     data-ng-click="toggleChain($index)"
                                     data-ng-mouseover="hoverChain($index)"
                                     data-ng-mouseleave="dehoverChain()"
                                     data-ng-class="{ selected : chains[chain.id].selected }">
                                    {{::chain.id}}
                                </div>
                            </div>

                            <!-- the alignment view -->
                            <div class="sequences">
                                <div data-ng-repeat="position in ::alignment.positions"
                                     class="position"
                                     data-ng-mouseover="hoverPosition($index)"
                                     data-ng-mouseleave="dehoverPosition()"
                                     data-ng-click="enterSelectionMode($index)"
                                     data-ng-class="{ uniform : position.uniform,
                                         mutation : position.mutant,
                                         variation : position.variant,
                                         focus : isFocusPosition($index),
                                         hover : isHoverPosition($index) }">
                                    {{::position.olcs}}
                                </div>
                            </div>
                        </div>

                        TODO move into tooltips, position index falsy
                        <div data-ng-repeat="position in ::alignment.positions | filter: { tooltip : 'true' }">
                            <div data-ng-repeat="mutation in position.mutations">
                                mutation @{{mutation.position}}
                                {{mutation.original}} -> {{mutation.variation}}
                                {{mutation.description}}
                            </div>
                            <div data-ng-repeat="variation in position.variants">
                                natural variant @{{variation.position}}
                                {{variation.original}} -> {{variation.variation}}
                                {{variation.description}}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        //TODO this is ugly
        $(this).delay(1000).queue(function() {
            $('.tse-scrollable').TrackpadScrollEmulator();

            $(this).dequeue();
        });
    </script>
</section>