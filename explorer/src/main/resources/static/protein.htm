<section data-ng-cloak class="text-left wrapper">
    <div data-ng-show="loading" class="overlay"></div>

    <!-- the visualizer part on the left -->
    <div class="visualization">
        <div class="wrapper">
            <div class="visualization-body">
                <div class="dropdown-select"
                     title="select feature to color visualization"
                     data-dropdown-select="features"
                     data-dropdown-model="options.coloringFeature"
                     data-dropdown-item-label="name">
                </div>

                <!-- PV instance -->
                <div id="protein-visualizer" class="visualizer-tab"></div>

                <!-- general render options -->
                <div class="visualization-options">
                    <!-- ligands -->
                    <div class="option fa fa-angle-right pull-right"
                         data-ng-click="options.renderLigands = !options.renderLigands"
                         data-ng-class="{active: options.renderLigands}"
                         title="render ligands"></div>
                </div>

                <!-- PLIP options -->
                <div class="visualization-options">
                    <div class="alert alert-danger"
                         data-ng-hide="protein.plipDataPresent">no plip data <span class="fa fa-exclamation"></span></div>
                    <div class="option fa fa-exchange pull-right"
                         data-ng-click="options.renderWaterBridges = !options.renderWaterBridges"
                         data-ng-class="{active: options.renderWaterBridges}"
                         title="render water bridges"
                         data-ng-show="protein.waterBridges.length > 0"></div>
                    <div class="option fa fa-exchange pull-right"
                         data-ng-click="options.renderSaltBridges = !options.renderSaltBridges"
                         data-ng-class="{active: options.renderSaltBridges}"
                         title="render salt bridges"
                         data-ng-show="protein.saltBridges.length > 0"></div>
                    <div class="option fa fa-database pull-right"
                         data-ng-click="options.renderPiStackings = !options.renderPiStackings"
                         data-ng-class="{active: options.renderPiStackings}"
                         title="render pi-stackings"
                         data-ng-show="protein.piStackings.length > 0"></div>
                    <div class="option fa fa-link pull-right"
                         data-ng-click="options.renderPiCationInteractions = !options.renderPiCationInteractions"
                         data-ng-class="{active: options.renderPiCationInteractions}"
                         title="render pi-cation interactions"
                         data-ng-show="protein.piCationInteractions.length > 0"></div>
                    <div class="option fa fa-arrows pull-right"
                         data-ng-click="options.renderMetalComplexes = !options.renderMetalComplexes"
                         data-ng-class="{active: options.renderMetalComplexes}"
                         title="render metal complexes"
                         data-ng-show="protein.metalComplexes.length > 0"></div>
                    <div class="option fa fa-exchange pull-right"
                         data-ng-click="options.renderHydrogenBonds = !options.renderHydrogenBonds"
                         data-ng-class="{active: options.renderHydrogenBonds}"
                         title="render hydrogen bonds"
                         data-ng-show="protein.hydrogenBonds.length > 0"></div>
                    <div class="option fa fa-exchange pull-right"
                         data-ng-click="options.renderHalogenBonds = !options.renderHalogenBonds"
                         data-ng-class="{active: options.renderHalogenBonds}"
                         title="render halogen bonds"
                         data-ng-show="protein.halogenBonds.length > 0"></div>
                </div>

                <!-- legends and description of coloring features -->
                <div class="legend" data-ng-hide="options.coloringFeature.tag != 'sse'">
                    <div style="color: hsl({{($index / (secondaryStructures.length - 1)) * 120}}, 60%, 70%);"
                         data-ng-repeat="secondaryStructure in secondaryStructures">{{secondaryStructure}}</div>
                </div>
                <div class="legend" data-ng-hide="options.coloringFeature.tag != 'sse'">
                    secondary structure annotation is performed by DSSP [kabsch, biojava]
                </div>
                <div class="legend" data-ng-hide="options.coloringFeature.tag != 'aa'">
                    <div style="color: hsl({{($index / (aminoAcids.length - 1)) * 120}}, 60%, 70%);"
                         data-ng-repeat="aminoAcid in aminoAcids">{{aminoAcid.tlc}}</div>
                </div>
                <div class="legend" data-ng-hide="options.coloringFeature.tag != 'aa'">
                    coloring is motivated by the amino acid's functional groups [gutteridge]
                </div>
                <div class="legend" data-ng-hide="options.coloringFeature.discrete || options.coloringFeature.tag == 'aa' || options.coloringFeature.tag == 'cerosene'">
                    <div style="color: hsl(0, 60%, 70%);">min</div>
                    <div style="color: hsl(60, 60%, 70%);">average</div>
                    <div style="color: hsl(120, 60%, 70%);">max</div>
                </div>
                <div class="legend" data-ng-hide="options.coloringFeature.tag != 'rasa'">
                    accessible surface area values are computed by biojava's ASA calculator [biojava] and normalized by the values of [matthew]
                </div>
                <div class="legend" data-ng-hide="options.coloringFeature.tag != 'cerosene'">
                    embedding in the RGB color space, similar color values indicate similar coordinates [heinke]
                </div>
            </div>
        </div>
    </div>

    <!-- the edit/data part on the right -->
    <div class="sequence">
        <div-- class="wrapper">
            <!-- general project navigation -->
            <div class="sequence-header clearfix">
                <div data-ng-class="{ active: isSelected(0) }" data-ng-click="selectTab(0)">general</div>
                <div data-ng-class="{ active: isSelected(1) }" data-ng-click="selectTab(1)">homologous</div>

                <div class="link pull-right" title="show in PDB">
                    <a target="_blank" data-ng-href="//www.rcsb.org/pdb/explore.do?structureId={{::protein.pdbId}}">PDB</a>
                    <span class="fa fa-external-link"></span>
                </div>
            </div>

            <div class="tse-scrollable">
                <div class="tse-content">
                    <!-- general information -->
                    <div data-ng-show="isSelected(0)" class="representation">
                        <div>pdbId: {{::protein.pdbId}}</div>
                        <div>chainId: {{::protein.chainId}}</div>
                        <div>title: {{::protein.title}}</div>
                        <div>
                            <ng-pluralize count="::protein.ligands.length"
                                      when="{'0': 'no ligands',
                                         'one': '1 ligand',
                                         'other': '{} ligands'}">
                            </ng-pluralize>
                            <ng-pluralize count="::(protein.ligands | filter: { type : 'water' }).length"
                                      when="{'0': '(none being water)',
                                     'one': '(1 being water)',
                                     'other': '({} being water)'}">
                            </ng-pluralize>
                        </div>
                        <div>
                            homologous protein chains:
                            <span data-ng-repeat="homolog in protein.homologous">
                                <a data-ng-href="chain/{{homolog}}">
                                    {{::homolog}}
                                </a>
                            </span>
                        </div>
                    </div>

                    <!-- homologous sequences -->
                    <div data-ng-show="isSelected(1)" class="representation homologous" data-ng-controller="MultiSequenceController as multiSequenceController">
                        <!-- navigation/editing/control over sequence objects -->
                        <div class="ids">
                            <div data-ng-repeat="chain in chains">
                                <input type="checkbox"
                                       data-ng-model="selectedChains[chain.id]"
                                       data-ng-click="toggleChain($index)"
                                       title="{{::chain.id}}">
                                {{::chain.id}}
                            </div>
                        </div>

                        <!-- the sequence view -->
                        <div class="sequences">
                            <div data-ng-repeat="chain in chains">
                                <span data-ng-repeat="aa in chain.sequence"
                                      data-ng-class="{ active: isVariant($index) }">{{::aa.olc}}</span>
                            </div>
                        </div>
                    </div>

                    <!-- uniprot mutations & diseases -->
                    <!--div data-ng-show="isSelected(6)" class="representation">
                        <div class="chain" data-ng-repeat="chain in protein.chains | filter: { hasAminoAcids : true } | filter: { mutationDataPresent : true }">
                            <h3>uniprot mutations</h3>
                            <div class="elementId"
                                 data-ng-mouseover="highlight(chain.id)"
                                 data-ng-mouseleave="deselect()">
                                <div>chain {{::chain.id}}</div>
                            </div>
                            <div class="elements">
                                <div class="element"
                                     data-ng-mouseover="highlight(chain.id, mutation.position[0], mutation.position[1])"
                                     data-ng-mouseleave="deselect()"
                                     data-ng-repeat="mutation in chain.mutations">
                                    <h3>mutation</h3>
                                    {{::mutation.original}} &rarr; {{::mutation.variation}}<br />
                                    {{::mutation.description}}<br />
                                    position: {{::mutation.position | formatPositions}}<br />
                                    <div data-ng-show="mutation.evidence.length > 0">
                                        evidence: <span data-ng-repeat="evidence in mutation.evidence"><a href="#ref:{{::chain.id}}:{{::evidence}}">{{::evidence}}</a> </span>
                                    </div>
                                    <br />
                                </div>
                                <div class="element"
                                     data-ng-mouseover="highlight(chain.id, variant.position[0], variant.position[1])"
                                     data-ng-mouseleave="deselect()"
                                     data-ng-repeat="variant in chain.variants">
                                    <h3>variant</h3>
                                    {{::variant.id}}<br />
                                    variation: {{::variant.original}} &rarr; {{::variant.variation}}<br />
                                    {{::variant.description}}<br />
                                    position: {{::variant.position | formatPositions}}<br />
                                    <div data-ng-show="variant.evidence.length > 0">
                                        evidence: <span data-ng-repeat="evidence in variant.evidence"><a href="#ref:{{::chain.id}}:{{::evidence}}">{{::evidence}}</a> </span>
                                    </div>
                                    <br />
                                </div>
                                <div class="element" data-ng-repeat="reference in chain.references">
                                    [<a name="ref:{{chain.id}}:{{$index + 1}}">{{$index + 1}}</a>] {{::reference.authors | formatAuthors}} {{::reference.title}} {{::reference.citation.name}} {{::reference.citation.date}}; {{::reference.citation.volume}}:{{::reference.citation.first}}-{{::reference.citation.last}}.<br />
                                    doi: <a target="_blank" data-ng-href="//dx.doi.org/{{::reference.doi}}">{{::reference.doi}}</a><br />
                                    PubMed: <a target="_blank" data-ng-href="//www.ncbi.nlm.nih.gov/pubmed/{{::reference.pubmed}}">{{::reference.pubmed}}</a>
                                </div>
                            </div>
                        </div>
                    </div-->
                </div>
            </div>
        </div>
    </div>

    <script>
        //TODO this is ugly
        $(this).delay(1000).queue(function() {
            $('.tse-scrollable').TrackpadScrollEmulator();

            $(this).dequeue();
        });
    </script>
</section>